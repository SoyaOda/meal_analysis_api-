食品バーコード栄養情報 API の詳細設計
Open Food Facts (OFF) と FoodData Central (FDC) の比較と商用利用の検討

データソースの概要:

Open Food Facts (OFF): 世界中の食品パッケージのバーコードと栄養情報を集めたオープンデータベースです。ユーザコミュニティによってバーコードや写真から情報が追加・編集されており、カバレッジ（収録製品数）が非常に広範なのが特徴です。ただしユーザ投稿によるため、**データのばらつきや不完全な項目（ノイズ）**も存在します。

FoodData Central (FDC): 米国農務省(USDA)が提供する公的な食品データベースです。生鮮食品からブランド食品まで網羅しており、成分分析に基づく高品質で精度の高い栄養データが含まれます。特に米国のブランド食品データはメーカーから提供され、公的に管理・更新されているため信頼性が高く、栄養素の網羅性も優れています。ただし、データセット規模は OFF に比べると小さめで、収録頻度も限られます。

商用利用での有利性:

ライセンスと利用制限: OFF のデータベースは Open Database License (ODbL)の下で公開されており、商用利用自体は可能ですが、利用時にはデータソースの帰属表示（例：「データ提供: Open Food Facts」）が必要です。また、データベース内容を改変・再配布する場合は同じ ODbL ライセンスで共有する義務があります。一方、FDC のデータは米国政府によるパブリックドメイン(CC0)として提供されており、著作権フリーかつ使用料も不要です。商用アプリで利用する際も特別な許可は不要で、USDA への謝辞（出典の明記）さえ行えば制約なく使えます。この点でライセンス面では FDC がシンプルで商用利用に適しています。

データの範囲と鮮度: 対象が主に米国内商品である場合、FDC の「Branded Foods（ブランド食品）」データセットが有力です。メーカー提供情報で月次更新されており、最新の栄養ラベルに近い内容が得られます。ただし、FDC はバーコードで直接検索する API を提供していないため、バーコード番号から該当食品を引くには一手間かかります（後述）。OFF はバーコード検索に対応しており即時照会が可能ですが、情報が古かったり不足している場合があります。

将来のトラフィック増加への対応: どちらの API も利用料は無料ですが、**アクセス頻度制限（レートリミット）**に注意が必要です。OFF は 1 分あたり 100 リクエスト程度の制限があり、FDC は API キーごとに 1 時間あたり 1000 リクエスト（IP 単位）の制限があります。大量トラフィック時にはキャッシュ戦略（後述）で外部 API への負荷を下げる必要があります。

以上を踏まえると、米国市場向け商用サービスでは FDC のデータ品質とライセンスの容易さが魅力的です。一方、FDC に存在しない食品やバーコード検索の利便性を考えると、OFF を補助的に併用する価値もあります。例えば「まず FDC で検索し、見つからなければ OFF で補完する」といったハイブリッド運用が考えられます。このように双方の利点を活かすことで、無料データ源のみで網羅性と精度のバランスを取ることができます。

実装アーキテクチャ概要（GTIN 正規化とキャッシュ構成）

全体フロー: ユーザーがバーコードをスキャンした際、そのバーコード値（GTIN コード）を API サーバに送信します。サーバ側では以下の処理を行います:

GTIN コードの正規化: バーコードは UPC/EAN など桁数が異なる形式がありえます。例えば米国の UPC-12 桁コードは、EAN-13 形式では先頭に 0 を付加した 13 桁になります
gs1us.org
。そのため、入力されたコードを標準的な形式（GTIN-13 もしくは GTIN-14）に変換し、不足桁があれば 0 埋めする処理を行います（チェックデジットも含めて検証）。これにより、データベース照合時のぶれを防ぎます。

キャッシュの確認: 正規化した GTIN コードをキーとしてキャッシュを参照します。過去に照会された食品であれば、その栄養情報をキャッシュから即座に返します。キャッシュには高速なインメモリストア（例: cachetools.TTLCache や Redis）が利用できます。TTL（Time-To-Live）を設定して一定時間後に自動で更新することで、データの陳腐化を防ぎつつ外部 API への問い合わせを削減します
blog.stackademic.com
。例えば、以下のように最大 1000 件・TTL5 分のメモリキャッシュを用意できます
blog.stackademic.com
:
